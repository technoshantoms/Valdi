load("//bzl:valdi_library.bzl", "COMMON_COMPILE_FLAGS")

COMPILER_FLAGS = COMMON_COMPILE_FLAGS + [
    "-Os",  # Always set optimization on
    "-Wno-pedantic",
    "-Wno-sign-compare",
    "-Wno-vla-extension",
    "-fno-exceptions",
    "-Wno-ignored-qualifiers",
    "-Wno-shorten-64-to-32",
    "-Wno-bitwise-instead-of-logical",
    "-Wno-unknown-warning-option",
]

cc_library(
    name = "yoga",
    visibility = ["//visibility:public"],
    deps = [":yoga_cc"] + select({
        "//bzl/conditions:ios": [":yoga_ios"],
        "//bzl/conditions:android": [":yoga_android"],
        "//conditions:default": [],
    }),
)

cc_library(
    name = "fbjni",
    srcs = glob([
        "src/android/jni/**/*.cpp",
        "src/android/lyra/**/*.cpp",
    ]),
    hdrs = glob(["src/android/include/**/*.h"]),
    copts = ["-Wno-unreachable-code"],
    includes = ["src/android/include"],
)

cc_library(
    name = "yoga_cc",
    srcs = glob([
        "src/yoga/**/*.cpp",
    ]),
    hdrs = glob([
        "src/yoga/**/*.h",
        "src/yoga/**/*.hpp",
    ]),
    copts = COMPILER_FLAGS,
    includes = [
        "src/yoga/event",
        "src/yoga/internal",
    ],
    deps = [":yoga_exported_headers"],
)

cc_library(
    name = "yoga_exported_headers",
    hdrs = glob([
        "src/yoga/**/*.h",
        "src/yoga/**/*.hpp",
    ]),
    includes = ["src"],
    tags = ["exported"],
)

objc_library(
    name = "yoga_ios",
    srcs = glob([
        "src/ios/yoga/**/*.m",
    ]),
    hdrs = glob([
        "src/ios/yoga/**/*.h",
    ]),
    includes = ["src/ios"],
    tags = ["exported"],
    deps = [
        ":yoga_cc",
    ],
)

cc_library(
    name = "yoga_android",
    strip_include_prefix = "src/yoga",
    deps = [
        ":fbjni",
        ":yoga_cc",
    ],
    alwayslink = True,
)
